---
- name: dump all
  hosts: all

  vars:
  - manageiq_connection:
      url: "{{ manageiq_connection.url }}"
      validate_certs: False
      token: "{{ manageiq_connection.token }}"

#  roles:
#  - syncrou.manageiq-vmdb

 
  tasks:
  - name: Set the automate workspace url
    set_fact:
      aws_url: "{{ manageiq.api_url }}/api/{{ manageiq.automate_workspace }}"
  - name: Fetch the Workspace
    uri:
      url: "{{ aws_url }}"
      method: GET 
      validate_certs: False
      headers:
        X-Auth-Token: "{{ manageiq.api_token }}"
        Content-Type: "application/json" 
      status_code: 200 
    register: workspace
  - debug: var=workspace

  - name: Fetch the task
    uri:
      url: "{{ manageiq.api_url }}/api/{{ request_task }}"
      method: GET
      validate_certs: False
      headers:
        X-Auth-Token: "{{ manageiq.api_token }}"
        Content-Type: "application/json"
      status_code: 200
    register: request_task

  - debug: var=request_task

#  - name: Get a vmdb object
#    manageiq_vmdb:
#      href: "{{ manageiq.request_task }}"
#    register: vmdb_object

  - name: get variables
    debug: var=hostvars[inventory_hostname]

